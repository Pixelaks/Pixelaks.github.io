<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adhyora Launch Trailer</title>
    <link href="https://fonts.googleapis.com/css2?family=Yatra+One&family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #10b981;
            --red: #ef4444;
            --blue: #3b82f6;
            --dark: #0f172a;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #ffffff !important; 
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            color: #1f2937;
        }

        /* Start Overlay */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff;
            display: flex; justify-content: center; align-items: center;
            z-index: 100; flex-direction: column;
            transition: opacity 0.8s cubic-bezier(0.22, 1, 0.36, 1), transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);
        }
        button.start-btn {
            padding: 18px 50px; font-size: 1.1rem; font-weight: 600; letter-spacing: 0.5px;
            background: var(--dark); color: white; border: none; border-radius: 50px;
            cursor: pointer; transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.3);
        }
        button.start-btn:hover { transform: scale(1.05) translateY(-2px); background: #000; box-shadow: 0 15px 40px -10px rgba(0, 0, 0, 0.4); }

        /* Record Button */
        .record-btn {
            position: absolute; top: 30px; right: 30px; z-index: 1000;
            padding: 12px 25px; font-size: 0.95rem; font-weight: 700;
            background: rgba(239, 68, 68, 0.1); color: var(--red);
            border: 2px solid var(--red); border-radius: 50px;
            cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center; gap: 8px; font-family: 'Inter', sans-serif;
        }
        .record-btn:hover { background: var(--red); color: white; transform: scale(1.05); }
        .record-btn.hidden { display: none !important; }

        /* Particle Canvas */
        #particle-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 15; pointer-events: none;
        }

        /* Liquid Gooey Filter Container */
        .shape-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
            filter: url(#goo);
        }

        /* The Pure Liquid Shapes */
        .shape {
            position: absolute;
            border-radius: 50%; 
            transition: top 1.2s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        left 1.2s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        height 1.2s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1),
                        opacity 1.2s ease, mix-blend-mode 1.2s ease;
            opacity: 1; 
            transform: translate(-50%, -50%) scale(1);
            animation: fluid-wobble 4s infinite alternate ease-in-out;
        }

        .shape.green { background: linear-gradient(135deg, #34d399, #059669); } 
        .shape.red   { background: linear-gradient(135deg, #f87171, #dc2626); animation-delay: -1.5s; } 
        .shape.blue  { background: linear-gradient(135deg, #60a5fa, #2563eb); animation-delay: -3s; } 

        @keyframes fluid-wobble {
            0%   { border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; }
            25%  { border-radius: 50% 50% 30% 70% / 70% 30% 70% 30%; }
            50%  { border-radius: 70% 30% 50% 50% / 30% 70% 30% 70%; }
            75%  { border-radius: 30% 70% 30% 70% / 50% 50% 70% 30%; }
            100% { border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; }
        }

        /* Text Layer */
        .text-layer {
            position: relative; z-index: 10; text-align: center; max-width: 900px; padding: 0 40px;
            transition: opacity 0.6s ease, transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), filter 0.6s ease;
            opacity: 0; transform: translateX(40px); filter: blur(5px);
        }
        
        .text-layer.hide { opacity: 0; transform: translateX(-40px); filter: blur(5px); }
        .text-layer.prep { opacity: 0; transform: translateX(40px); filter: blur(5px); transition: none; }
        .text-layer.active { opacity: 1; transform: translateX(0px); filter: blur(0px); }

        .text-layer h1 { margin: 0; line-height: 1.05; transition: color 0.5s ease; }
        .text-layer p { font-size: 1.6rem; margin-top: 24px; font-weight: 500; color: #374151; line-height: 1.5; letter-spacing: 0px; transition: color 0.5s ease; min-height: 80px;}

        /* Typography */
        .font-sans { font-family: 'Inter', sans-serif; font-size: 5.5rem; letter-spacing: -3px; font-weight: 900; color: var(--dark); }
        .font-yatra { font-family: 'Yatra One', cursive; font-size: 9rem; color: var(--dark); }
        .outro-sub { font-size: 1.5rem !important; font-weight: 400 !important; color: #4b5563 !important; letter-spacing: 0px !important; text-transform: none !important; margin-top: 25px !important;}
        
        .text-green { color: #059669; } .text-red { color: #dc2626; } .text-blue { color: #2563eb; }
        .sub-highlight { font-weight: 700; color: var(--dark); transition: color 0.5s ease; }

        /* Dynamic Text Inversion (ONLY for Intense Liquid Scenes) */
        body[data-state="meet"] .text-layer h1, 
        body[data-state="principal"] .text-layer h1, 
        body[data-state="teacher"] .text-layer h1, 
        body[data-state="student"] .text-layer h1,
        body[data-state="security"] .text-layer h1 { color: #ffffff; text-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        body[data-state="meet"] .text-layer p, 
        body[data-state="principal"] .text-layer p, 
        body[data-state="teacher"] .text-layer p, 
        body[data-state="student"] .text-layer p,
        body[data-state="security"] .text-layer p { color: rgba(255,255,255,0.95); text-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        body[data-state="meet"] .sub-highlight, 
        body[data-state="principal"] .sub-highlight, 
        body[data-state="teacher"] .sub-highlight, 
        body[data-state="student"] .sub-highlight,
        body[data-state="security"] .sub-highlight { color: #ffffff; }

        /* Typewriter Cursor */
        .cursor { display: inline-block; width: 4px; margin-left: 2px; color: inherit; animation: blink 1s step-end infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* --- THE PROFESSIONAL LOCK --- */
        #premium-lock-container { display: none; position: relative; width: 140px; height: 140px; margin: 0 auto 40px auto; }
        
        /* Pulse the entire lock container exactly when the shackle snaps */
        body[data-state="security"] #premium-lock-container { display: block; animation: lock-reveal 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards, lock-pulse 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) 1.6s forwards; }
        
        @keyframes lock-reveal { 0% { opacity: 0; transform: scale(0.8) translateY(20px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes lock-pulse { 0% { transform: scale(1); } 40% { transform: scale(0.88) translateY(4px); } 100% { transform: scale(1); } }
        
        .lock-svg { position: relative; z-index: 1; width: 100%; height: 100%; }
        
        /* Shackle draws while hovered up, then snaps down */
        .lock-shackle { stroke: #ffffff; stroke-width: 8; stroke-linecap: round; fill: none; stroke-dasharray: 100; stroke-dashoffset: 100; transform-origin: center; transform: translateY(-18px); transition: stroke-dashoffset 0.8s cubic-bezier(0.22, 1, 0.36, 1) 0.8s; }
        .lock-body { fill: transparent; stroke: #ffffff; stroke-width: 8; rx: 16; stroke-dasharray: 250; stroke-dashoffset: 250; transition: stroke-dashoffset 0.8s cubic-bezier(0.22, 1, 0.36, 1) 0.6s, fill 0.6s ease 1.6s; }
        .keyhole { fill: var(--dark); opacity: 0; transition: opacity 0.4s ease 1.6s; }

        body[data-state="security"] .lock-body { stroke-dashoffset: 0; fill: #ffffff; }
        body[data-state="security"] .lock-shackle { stroke-dashoffset: 0; animation: shackle-snap 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) 1.6s forwards; }
        body[data-state="security"] .keyhole { opacity: 1; }
        
        @keyframes shackle-snap { 0% { transform: translateY(-18px); } 100% { transform: translateY(0); } }

        /* --- THE NEW PIPELINE DEPLOYMENT UI --- */
        #deployment-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; z-index: 20; transition: opacity 0.6s ease;
        }
        
        body[data-state="deploy-all"] #deployment-ui { opacity: 1; pointer-events: auto; }

        .deploy-title {
            font-family: 'Inter', sans-serif; font-size: 2.2rem; letter-spacing: 5px;
            font-weight: 900; color: var(--dark); position: absolute; top: 12%;
            left: 50%; width: 100%; text-align: center;
            transform: translate(-50%, 20px); opacity: 0; transition: all 0.6s ease;
        }
        body[data-state="deploy-all"] .deploy-title { transform: translate(-50%, 0); opacity: 1; transition-delay: 0.2s; }

        .pipeline-container {
            position: relative; width: 80%; max-width: 1100px; height: 350px; margin-top: 50px;
        }
        
        .pipeline-track {
            position: absolute; top: 50%; left: 10%; width: 80%; height: 6px; 
            background: #e2e8f0; border-radius: 3px; transform: translateY(-50%);
        }
        
        .pipeline-progress {
            position: absolute; top: 50%; left: 10%; width: 0%; height: 6px; 
            background: linear-gradient(90deg, var(--green), var(--red), var(--blue)); 
            border-radius: 3px; transform: translateY(-50%);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1) 0.5s;
        }
        body[data-state="deploy-all"] .pipeline-progress { width: 80%; }

        /* Anchored Node Container */
        .pipeline-node {
            position: absolute; top: 50%; width: 280px; text-align: center;
            transform: translate(-50%, -50%); height: 0; 
            display: flex; justify-content: center; z-index: 30;
        }
        #p-node-1 { left: 15%; }
        #p-node-2 { left: 50%; }
        #p-node-3 { left: 85%; }

        /* The glowing ring label */
        .node-label {
            font-size: 1.5rem; font-weight: 900; opacity: 0; 
            position: absolute; top: 0; left: 50%;
            width: 60px; height: 60px; line-height: 54px;
            background: #ffffff; border-radius: 50%;
            border: 3px solid currentColor;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transform: translate(-50%, -50%) scale(0.5);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        /* The modern glass card */
        .node-content {
            opacity: 0; 
            position: absolute; top: 50px; left: 50%; width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(229, 231, 235, 0.5);
            padding: 24px 20px; border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.12);
            transform: translate(-50%, 20px); 
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .node-content h3 { font-size: 1.25rem; color: var(--dark); margin: 0 0 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;}
        .node-content p { font-size: 1rem; color: #4b5563; line-height: 1.5; margin: 0; font-weight: 500;}

        /* Sequential UI Reveal exactly synced with liquid blobs */
        body[data-state="deploy-all"] .node-label { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        body[data-state="deploy-all"] .node-content { opacity: 1; transform: translate(-50%, 0px); }
        
        body[data-state="deploy-all"] #p-node-1 .node-label, body[data-state="deploy-all"] #p-node-1 .node-content { transition-delay: 1.4s; }
        body[data-state="deploy-all"] #p-node-2 .node-label, body[data-state="deploy-all"] #p-node-2 .node-content { transition-delay: 1.8s; }
        body[data-state="deploy-all"] #p-node-3 .node-label, body[data-state="deploy-all"] #p-node-3 .node-content { transition-delay: 2.2s; }

        /* --- STATE ANIMATIONS --- */
        
        body[data-state="idle"] .shape { width: 0; height: 0; }

        /* Intro */
        body[data-state="intro"] .shape.green { width: 220px; height: 220px; top: 15%; left: 30%; }
        body[data-state="intro"] .shape.red   { width: 180px; height: 180px; top: 80%; left: 35%; }
        body[data-state="intro"] .shape.blue  { width: 200px; height: 200px; top: 40%; left: 80%; }

        /* Meet: 100% Intensity, Stacked layers (top color shows perfectly) */
        body[data-state="meet"] .shape { opacity: 1; }
        body[data-state="meet"] .shape.green { width: 550px; height: 550px; top: 45%; left: 47%; z-index: 1; }
        body[data-state="meet"] .shape.red   { width: 480px; height: 480px; top: 52%; left: 55%; z-index: 2; }
        body[data-state="meet"] .shape.blue  { width: 400px; height: 400px; top: 56%; left: 45%; z-index: 3; }

        /* THE LIQUID BLAST MORPHS */
        body[data-state="principal"] .shape.green { width: 850px; height: 850px; top: 50%; left: 50%; opacity: 1; z-index: 0; }
        body[data-state="principal"] .shape.red   { width: 0px; height: 0px; top: 50%; left: 50%; z-index: -1; }
        body[data-state="principal"] .shape.blue  { width: 0px; height: 0px; top: 50%; left: 50%; z-index: -1; }

        body[data-state="teacher"] .shape.red   { width: 850px; height: 850px; top: 50%; left: 50%; opacity: 1; z-index: 0; }
        body[data-state="teacher"] .shape.green { width: 0px; height: 0px; top: 50%; left: 50%; z-index: -1; }
        body[data-state="teacher"] .shape.blue  { width: 0px; height: 0px; top: 50%; left: 50%; z-index: -1; }

        body[data-state="student"] .shape.blue  { width: 850px; height: 850px; top: 50%; left: 50%; opacity: 1; z-index: 0; }
        body[data-state="student"] .shape.red   { width: 0px; height: 0px; top: 50%; left: 50%; z-index: -1; }
        body[data-state="student"] .shape.green { width: 0px; height: 0px; top: 50%; left: 50%; z-index: -1; }

        /* Features */
        body[data-state="attendance"] .shape { width: 500px; height: 500px; opacity: 1; }
        body[data-state="attendance"] .shape.green { top: 20%; left: 25%; }
        body[data-state="attendance"] .shape.red   { top: 80%; left: 40%; }
        body[data-state="attendance"] .shape.blue  { top: 40%; left: 80%; }

        body[data-state="nep"] .shape { width: 600px; height: 600px; opacity: 1; }
        body[data-state="nep"] .shape.green { top: 40%; left: 20%; }
        body[data-state="nep"] .shape.blue  { top: 60%; left: 80%; }
        body[data-state="nep"] .shape.red   { top: 120%; left: 50%; width: 250px; height: 250px; opacity: 1; } 

        /* COOL DATA PIPELINE LIQUID MOVEMENT */
        body[data-state="deploy-all"] .shape { width: 70px; height: 70px; opacity: 1; z-index: 22; transition: all 1s cubic-bezier(0.22, 1, 0.36, 1); mix-blend-mode: normal; }
        body[data-state="deploy-all"] .shape.green { top: 50%; left: 15%; transition-delay: 0.4s; }
        body[data-state="deploy-all"] .shape.red   { top: 50%; left: 50%; transition-delay: 0.8s; }
        body[data-state="deploy-all"] .shape.blue  { top: 50%; left: 85%; transition-delay: 1.2s; }

        /* SIRI-STYLE FLUID COMBINATION for Security State */
        body[data-state="security"] .shape { opacity: 0.85; mix-blend-mode: multiply; width: 600px; height: 600px; z-index: 0; }
        body[data-state="security"] .shape.green { top: 50%; left: 50%; transform-origin: 53% 47%; animation: fluid-wobble 4s infinite alternate, siri-spin-right 6s infinite linear;}
        body[data-state="security"] .shape.red   { top: 50%; left: 50%; transform-origin: 47% 53%; animation: fluid-wobble 5s infinite alternate-reverse, siri-spin-left 8s infinite linear;}
        body[data-state="security"] .shape.blue  { top: 50%; left: 50%; transform-origin: 50% 50%; animation: fluid-wobble 3s infinite alternate, siri-spin-right 10s infinite linear;}
        
        @keyframes siri-spin-right { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        @keyframes siri-spin-left { 0% { transform: translate(-50%, -50%) rotate(360deg); } 100% { transform: translate(-50%, -50%) rotate(0deg); } }

        /* Outro: Smooth Cinematic Dissolve Fade Out 
           - Overrides the base 1.2s transition to provide a slow, gorgeous 2.5s fade and blur effect without shrinking.
        */
        body[data-state="outro"] .shape { 
            width: 600px; height: 600px; top: 50%; left: 50%; 
            opacity: 0; 
            mix-blend-mode: multiply;
            filter: blur(40px);
            transform: translate(-50%, -50%) scale(1.3);
            transition: opacity 2.5s ease-in-out, filter 2.5s ease-in-out, transform 2.5s ease-in-out;
        }
    </style>
</head>
<body data-state="idle">

    <!-- Record Button (Fixed Top Right) -->
    <button id="record-btn" class="record-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>
        Record Trailer
    </button>

    <!-- Particle Engine Overlay -->
    <canvas id="particle-canvas"></canvas>

    <svg style="position: absolute; width: 0; height: 0;" aria-hidden="true">
      <filter id="goo">
        <feGaussianBlur in="SourceGraphic" stdDeviation="20" result="blur" />
        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 35 -15" result="goo" />
        <feBlend in="SourceGraphic" in2="goo" />
      </filter>
    </svg>

    <div id="start-screen">
        <h2 style="font-family: 'Yatra One', cursive; font-size: 4.5rem; margin-bottom: 0px; color: var(--dark);">Adhyora</h2>
        <p style="margin-top: 5px; margin-bottom: 40px; color: #6b7280; font-size: 1.1rem; font-weight: 600; text-transform: uppercase; letter-spacing: 4px;">Launch Trailer</p>
        <button class="start-btn" onclick="startTrailer()">Start Experience</button>
    </div>

    <!-- The Liquid Elements -->
    <div class="shape-container">
        <div class="shape green" id="blob-green"></div>
        <div class="shape red" id="blob-red"></div>
        <div class="shape blue" id="blob-blue"></div>
    </div>

    <!-- New Data Pipeline Deployment Protocol UI -->
    <div id="deployment-ui">
        <h2 class="deploy-title">DEPLOYMENT PROTOCOL</h2>
        <div class="pipeline-container">
            <div class="pipeline-track"></div>
            <div class="pipeline-progress"></div>
            
            <div class="pipeline-node" id="p-node-1">
                <div class="node-label" style="color: var(--green);">01</div>
                <div class="node-content">
                    <h3>Data Import</h3>
                    <p>Migrate your existing student and faculty records securely into the Adhyora cloud architecture.</p>
                </div>
            </div>

            <div class="pipeline-node" id="p-node-2">
                <div class="node-label" style="color: var(--red);">02</div>
                <div class="node-content">
                    <h3>Structure Config</h3>
                    <p>Configure your academic year, NEP/Traditional syllabus mode, and attendance calculation logic.</p>
                </div>
            </div>

            <div class="pipeline-node" id="p-node-3">
                <div class="node-label" style="color: var(--blue);">03</div>
                <div class="node-content">
                    <h3>Live Deployment</h3>
                    <p>Issue credentials to staff and students. Your institution is now fully digital and operational.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- The Text and UI Container -->
    <div class="text-layer prep" id="text-container">
        <!-- The Minimalist Lock -->
        <div id="premium-lock-container">
            <svg class="lock-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path class="lock-shackle" d="M 30 45 V 25 C 30 12 70 12 70 25 V 45" />
                <rect class="lock-body" x="15" y="42" width="70" height="50" />
                <circle class="keyhole" cx="50" cy="62" r="5" />
                <path class="keyhole" d="M 47 65 L 45 78 H 55 L 53 65 Z" />
            </svg>
        </div>

        <h1 id="main-text" class="font-sans"></h1>
        <p id="sub-text"></p>
    </div>

    <script>
        /* --- Recording Engine --- */
        let mediaRecorder;
        let recordedChunks = [];

        document.getElementById('record-btn').addEventListener('click', async function() {
            try {
                // Request tab/screen capture for maximum quality
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { displaySurface: "browser" },
                    audio: false
                });
                
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                
                mediaRecorder.ondataavailable = e => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = 'Adhyora_Trailer.webm';
                    document.body.appendChild(a);
                    a.click();
                    setTimeout(() => { document.body.removeChild(a); window.URL.revokeObjectURL(url); }, 100);
                    recordedChunks = []; // reset
                };
                
                mediaRecorder.start();
                this.classList.add('hidden'); // Hide the record button!
            } catch(e) {
                console.error("Screen recording failed or was denied:", e);
                alert("Could not start recording. Please allow screen/tab capture.");
            }
        });

        /* --- Sequential Particle Engine JS --- */
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        let particles = [];
        let isAnimatingParticles = false;

        class Particle {
            constructor(x, y, colorCode) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 5 + 2;
                this.color = colorCode;
                // Explosive radial velocity
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 15 + 5;
                this.speedX = Math.cos(angle) * velocity;
                this.speedY = Math.sin(angle) * velocity;
                this.friction = 0.90;
                this.life = 1.0;
                this.decay = Math.random() * 0.03 + 0.01;
            }
            update() {
                this.speedX *= this.friction;
                this.speedY *= this.friction;
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= this.decay;
            }
            draw() {
                ctx.globalAlpha = Math.max(0, this.life);
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            }
        }

        function triggerParticleBurstAt(xPercent, hexColor) {
            const pointX = window.innerWidth * xPercent;
            const pointY = window.innerHeight / 2;
            
            for(let i = 0; i < 200; i++) {
                particles.push(new Particle(pointX, pointY, hexColor));
            }
            
            if(!isAnimatingParticles) {
                isAnimatingParticles = true;
                animateParticles();
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            for(let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                if(particles[i].life > 0) active = true;
            }
            if(active) {
                requestAnimationFrame(animateParticles);
            } else {
                isAnimatingParticles = false;
                particles = [];
            }
        }

        /* --- Robust HTML-Aware Typewriter --- */
        async function typeHTML(element, htmlString, speed) {
            element.innerHTML = '';
            let i = 0;
            let currentHTML = '';
            
            while (i < htmlString.length) {
                if (htmlString[i] === '<') {
                    // Extract full HTML tag to avoid typing it out
                    let tag = '';
                    while (htmlString[i] !== '>' && i < htmlString.length) {
                        tag += htmlString[i];
                        i++;
                    }
                    tag += '>';
                    currentHTML += tag;
                    element.innerHTML = currentHTML + '<span class="cursor">|</span>';
                    i++;
                } else {
                    currentHTML += htmlString[i];
                    element.innerHTML = currentHTML + '<span class="cursor">|</span>';
                    await new Promise(r => setTimeout(r, speed));
                    i++;
                }
            }
            element.innerHTML = currentHTML; // Typing complete, remove cursor
        }

        /* --- Trailer Timeline Logic --- */
        const timeline = [
            { delay: 2000, text: "The future of campus management.", sub: "", fontClass: "font-sans", state: "intro" },
            { delay: 3500, text: "Adhyora", sub: "The definitive college ecosystem.", fontClass: "font-yatra", state: "meet" },
            
            { delay: 4000, text: "Absolute Authority.", sub: "The ultimate command center for <span class='sub-highlight'>Principals</span>.", fontClass: "font-sans", state: "principal" },
            { delay: 4000, text: "Frictionless Workflows.", sub: "Automated grading and attendance for <span class='sub-highlight'>Teachers</span>.", fontClass: "font-sans", state: "teacher" },
            { delay: 4000, text: "Everything, Everywhere.", sub: "Real-time academic clarity for <span class='sub-highlight'>Students</span>.", fontClass: "font-sans", state: "student" },
            
            { delay: 4500, text: "Built for Tomorrow.", sub: "Native <span class='sub-highlight'>NEP</span> and <span class='sub-highlight'>Traditional</span> syllabus support.<br>Instantly configurable to your standards.", fontClass: "font-sans", state: "nep" },
            
            { delay: 5000, text: "Adaptive Attendance Logic.", sub: "Multi-mode percentage thresholds. <span class='sub-highlight'>Session, hour, or subject-specific.</span><br>We adapt to your rules, not the other way around.", fontClass: "font-sans", state: "attendance" },
            
            { delay: 7000, state: "deploy-all" },

            { 
  delay: 6500, 
  text: "Fort Knox, Digitized.", 
  sub: "<span style='text-shadow: 2px 2px 4px #000000;'><span class='sub-highlight'>AES-256</span> Encryption. <br><span class='sub-highlight'>Granular RBAC</span> ensures verified institutional access only.<br>Your institutional data, permanently locked down.</span>", 
  fontClass: "font-sans", 
  state: "security" 
},
            
            { delay: 6000, text: "Adhyora", sub: "<span style='font-size: 1.4rem;'>Upgrade your institution today.</span><br><span style='font-weight: 700; color: #0f172a; letter-spacing: 1px;'>pixelaks.in/adhyora</span>", fontClass: "font-yatra", state: "outro", subClass: "outro-sub" }
        ];

        async function startTrailer() {
            // Remove the record button dynamically if they chose not to click it before starting
            document.getElementById('record-btn').classList.add('hidden');

            const startScreen = document.getElementById('start-screen');
            startScreen.style.opacity = 0;
            startScreen.style.transform = 'scale(1.05)';
            setTimeout(() => { startScreen.style.display = 'none'; }, 800);
            
            const textContainer = document.getElementById('text-container');
            const mainText = document.getElementById('main-text');
            const subText = document.getElementById('sub-text');
            const lockContainer = document.getElementById('premium-lock-container');

            for (let i = 0; i < timeline.length; i++) {
                const step = timeline[i];
                
                // Hide main text layer smoothly
                if (textContainer.style.display !== 'none') {
                    textContainer.className = 'text-layer hide';
                    await new Promise(r => setTimeout(r, 600)); 
                }

                // Custom Cool Data Pipeline Logic
                if (step.state === 'deploy-all') {
                    textContainer.style.display = 'none';
                    document.body.setAttribute('data-state', step.state);
                    
                    setTimeout(() => { triggerParticleBurstAt(0.15, '#10b981'); }, 1400); 
                    setTimeout(() => { triggerParticleBurstAt(0.50, '#ef4444'); }, 1800); 
                    setTimeout(() => { triggerParticleBurstAt(0.85, '#3b82f6'); }, 2200); 

                    await new Promise(r => setTimeout(r, step.delay));
                    continue; 
                } else {
                    textContainer.style.display = 'block';
                }

                // Security Typewriter Injection
                if (step.state === 'security') {
                    document.body.setAttribute('data-state', step.state);
                    lockContainer.style.display = 'block';
                    
                    mainText.className = step.fontClass;
                    mainText.innerHTML = step.text; 
                    subText.className = step.subClass || "";
                    subText.innerHTML = ""; // Clear for typewriter
                    
                    subText.style.transition = 'none';
                    subText.style.opacity = '1';
                    subText.style.transform = 'translateY(0px)';
                    subText.style.filter = 'blur(0px)';
                    
                    textContainer.className = 'text-layer active';

                    await new Promise(r => setTimeout(r, 1600)); 
                    await typeHTML(subText, step.sub, 30);
                    
                    await new Promise(r => setTimeout(r, step.delay - 1600));
                    continue;
                }

                // Cinematic Typewriter Outro
                if (step.state === 'outro') {
                    document.body.setAttribute('data-state', step.state); // Orb begins its 2.5s fade out here
                    lockContainer.style.display = 'none';
                    
                    mainText.className = step.fontClass;
                    mainText.innerHTML = "";
                    subText.innerHTML = "";
                    textContainer.className = 'text-layer active';
                    
                    // NEW: Wait EXACTLY for the 2.5s security orb dissolve transition to finish completely!
                    await new Promise(r => setTimeout(r, 2500)); 
                    
                    // Now begin typing the big title
                    await typeHTML(mainText, step.text, 120);
                    
                    await new Promise(r => setTimeout(r, 300));
                    subText.className = step.subClass || "";
                    subText.innerHTML = step.sub;
                    
                    subText.style.transition = 'none';
                    subText.style.opacity = '0';
                    subText.style.transform = 'translateY(15px)';
                    subText.style.filter = 'blur(8px)';
                    
                    void subText.offsetWidth; 
                    
                    subText.style.transition = 'opacity 2s ease, transform 2s ease, filter 2s ease';
                    subText.style.opacity = '1';
                    subText.style.transform = 'translateY(0px)';
                    subText.style.filter = 'blur(0px)';

                    await new Promise(r => setTimeout(r, step.delay));
                    continue; 
                }

                // Standard Step Logic
                mainText.className = step.fontClass;
                mainText.innerHTML = step.text; 
                subText.className = step.subClass || "";
                subText.innerHTML = step.sub;
                subText.style.opacity = 1; 
                subText.style.transform = 'translateY(0px)';
                subText.style.filter = 'blur(0px)';
                
                textContainer.className = 'text-layer prep';
                lockContainer.style.display = 'none';

                document.body.setAttribute('data-state', step.state);
                await new Promise(r => setTimeout(r, 100));

                textContainer.className = 'text-layer active';
                await new Promise(r => setTimeout(r, step.delay));
            }

            // AUTO-STOP REMOVED AS PER REQUEST
        }
    </script>
</body>
</html>